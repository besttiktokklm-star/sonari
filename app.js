(function(){const c=document.getElementById('cookie');if(c&&!localStorage.getItem('sonari-cookies')){c.style.display='block';document.getElementById('cookieAccept').addEventListener('click',()=>{localStorage.setItem('sonari-cookies','1');c.remove();});}const o=document.getElementById('openCheckout'),m=document.getElementById('checkout');if(o&&m){o.addEventListener('click',()=>m.style.display='block');document.getElementById('closeCheckout').addEventListener('click',()=>m.style.display='none');document.getElementById('confirmPay')?.addEventListener('click',()=>{localStorage.setItem('sonari-premium','1');});}if(document.getElementById('play')){let ctx,master,nodes={},timer=null,endAt=0;function init(){if(ctx)return;ctx=new (window.AudioContext||window.webkitAudioContext)();master=ctx.createGain();master.connect(ctx.destination);nodes.rain={gain:ctx.createGain()};nodes.pink={gain:ctx.createGain()};nodes.pad={gain:ctx.createGain()};nodes.rain.gain.connect(master);nodes.pink.gain.connect(master);nodes.pad.gain.connect(master);const size=2*ctx.sampleRate;const buf=ctx.createBuffer(1,size,ctx.sampleRate);const d=buf.getChannelData(0);for(let i=0;i<size;i++)d[i]=Math.random()*2-1;const src=ctx.createBufferSource();src.buffer=buf;src.loop=true;const hp=ctx.createBiquadFilter();hp.type='highpass';hp.frequency.value=500;const lp=ctx.createBiquadFilter();lp.type='lowpass';lp.frequency.value=6500;src.connect(hp).connect(lp).connect(nodes.rain.gain);src.start();nodes.rain.src=src;const N=4096;const sp=ctx.createScriptProcessor(N,1,1);let b0=0,b1=0,b2=0,b3=0,b4=0,b5=0,b6=0;sp.onaudioprocess=e=>{const out=e.outputBuffer.getChannelData(0);for(let i=0;i<N;i++){const w=Math.random()*2-1;b0=0.99886*b0+w*0.0555179;b1=0.99332*b1+w*0.0750759;b2=0.969*b2+w*0.153852;b3=0.8665*b3+w*0.3104856;b4=0.55*b4+w*0.5329522;b5=-0.7616*b5-w*0.016898;out[i]=(b0+b1+b2+b3+b4+b5+b6+w*0.5362)*0.11;b6=w*0.115926;}};sp.connect(nodes.pink.gain);nodes.pink.node=sp;const o1=ctx.createOscillator(),o2=ctx.createOscillator();o1.type='sine';o2.type='triangle';o1.frequency.value=220;o2.frequency.value=222.2;const lpf=ctx.createBiquadFilter();lpf.type='lowpass';lpf.frequency.value=600;const g=ctx.createGain();g.gain.value=0.25;const lfo=ctx.createOscillator();const lfoG=ctx.createGain();lfo.frequency.value=0.08;lfoG.gain.value=80;lfo.connect(lfoG).connect(lpf.frequency);o1.connect(lpf);o2.connect(lpf);lpf.connect(g).connect(nodes.pad.gain);o1.start();o2.start();lfo.start();nodes.pad={...nodes.pad,o1,o2,lpf,g,lfo};}function apply(){if(!ctx)return;nodes.rain.gain.gain.value=document.getElementById('rain').value/100*0.9;nodes.pink.gain.gain.value=document.getElementById('pink').value/100*0.6;nodes.pad.gain.gain.value=document.getElementById('pad').value/100*0.7;}function start(){init();apply();ctx.resume();const mins=parseInt(document.getElementById('mins').value,10);endAt=Date.now()+mins*60*1000;clearInterval(timer);timer=setInterval(()=>{const left=Math.max(0,endAt-Date.now());const s=Math.round(left/1000);const mm=String(Math.floor(s/60)).padStart(2,'0');const ss=String(s%60).padStart(2,'0');document.getElementById('timer').textContent=mm+':'+ss;const total=mins*60*1000;const r=(total-left)/total;document.getElementById('progress').style.width=(r*100)+'%';if(left<=0){stop();}},250);}function stop(){clearInterval(timer);document.getElementById('progress').style.width='0%';ctx&&ctx.suspend();}document.getElementById('play').addEventListener('click',start);document.getElementById('stop').addEventListener('click',stop);['rain','pink','pad'].forEach(id=>document.getElementById(id).addEventListener('input',apply));}})();